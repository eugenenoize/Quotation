function GetCategories(){$.ajax({url:"api/categories",type:"GET",contentType:"application/json",success:function(n){var t="";$.each(n,function(n,i){t+=option(i)});$("#quoteForm select").append(t)}})}function GetQuotes(){$.ajax({url:"/api/quotes",type:"GET",contentType:"application/json",success:function(n){var t="";$.each(n,function(n,i){t+=row(i)});$("table tbody").append(t)}})}function GetQuote(n){$.ajax({url:"api/quotes/"+n,type:"GET",contentType:"application/json",success:function(n){var i=n.categoryId,t=document.forms.quoteForm;t.elements.id.value=n.id;t.elements.author.value=n.author;t.elements.text.value=n.text;t.elements.datecreate.value=n.dateCreate;$("select option[value = "+i+"]").attr("selected","true")}})}function CreateQuote(n,t,i){$("#errors").empty().hide();$.ajax({url:"api/quotes",contentType:"application/json",method:"POST",data:JSON.stringify({author:n,text:t,categoryid:i}),success:function(n){reset();$("table tbody").append(row(n))},error:function(n){if(n.responseText==="")$("#errors").append("<h3>"+n.statusText+"<\/h3>");else{var t=JSON.parse(n.responseText);t[""]&&$.each(t[""],function(n,t){$("#errors").append("<p>"+t+"<\/p>")});t.Author&&$.each(t.Author,function(n,t){$("#errors").append("<p>"+t+"<\/p>")});t.Text&&$.each(t.Text,function(n,t){$("#errors").append("<p>"+t+"<\/p>")})}$("#errors").show()}})}function EditQuote(n,t,i,r,u){$("#errors").empty().hide();$.ajax({url:"api/quotes",contentType:"application/json",method:"PUT",data:JSON.stringify({id:n,author:t,text:i,datecreate:r,categoryid:u}),success:function(n){reset();$("tr[data-rowid='"+n.id+"']").replaceWith(row(n))},error:function(n){if(n.responseText==="")$("#errors").append("<h3>"+n.statusText+"<\/h3>");else{var t=JSON.parse(n.responseText);t[""]&&$.each(t[""],function(n,t){$("#errors").append("<p>"+t+"<\/p>")});t.Author&&$.each(t.Author,function(n,t){$("#errors").append("<p>"+t+"<\/p>")});t.Text&&$.each(t.Text,function(n,t){$("#errors").append("<p>"+t+"<\/p>")})}$("#errors").show()}})}function DeleteQuote(n){$.ajax({url:"api/quotes/"+n,contentType:"application/json",method:"DELETE",success:function(n){$("tr[data-rowid='"+n.id+"']").remove()}})}function reset(){var n=document.forms.quoteForm;n.reset();$("#errors").empty().hide();n.elements.id.value=0}function SortQuote(n){$.ajax({url:"/api/quotes/sortquote/"+n,type:"GET",contentType:"application/json",success:function(n){var t="";$.each(n,function(n,i){t+=row(i)});$("table tbody").empty();$("table tbody").append(t)}})}var row=function(n){var t=moment.utc(n.dateCreate).toDate();return t=moment(t).format("DD.MM.YYYY HH:mm"),GetCategories,"<tr  data-rowid='"+n.id+"'><td hidden>"+n.id+"<\/td><td>"+n.author+"<\/td><td>"+n.text+"<\/td><td>"+t+"<\/td><td>"+n.category.name+"<\/td><td><a class='editLink' data-id='"+n.id+"'>Изменить<\/a> | <a class='removeLink' data-id='"+n.id+"'>Удалить<\/a><\/td><\/tr>"},option=function(n){return"<option value='"+n.id+"'>"+n.name+"<\/option>"};$("#reset").click(function(n){n.preventDefault();reset()});$("form").submit(function(n){n.preventDefault();var t=this.elements.id.value,i=this.elements.author.value,r=this.elements.text.value,f=this.elements.datecreate.value,u=this.elements.category.value;t==0?CreateQuote(i,r,u):EditQuote(t,i,r,f,u)});$("body").on("click",".editLink",function(){var n=$(this).data("id");GetQuote(n)});$("body").on("click",".removeLink",function(){var n=$(this).data("id");DeleteQuote(n)});$(".sortquote").click(function(){SortQuote($(this).val())});GetQuotes();GetCategories();